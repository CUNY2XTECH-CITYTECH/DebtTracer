<!DOCTYPE html>
<html lang="<%= lang %>">
  <head>
    <meta charset="UTF-8" />
    <title><%= t('title') %></title>
    <link rel="stylesheet" href="styles/styles.css" />
    <link rel="stylesheet" href="styles/aiChat.css">
    <link rel="stylesheet" href="styles/profilePic.css">
    <link rel="stylesheet" href="styles/pieCharts.css">
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <style>
    .grid { display: grid; gap: 1rem; }
    .grid-2 { grid-template-columns: 1fr 1fr; }gthy  m
    .card { background:#fff; border-radius:16px; box-shadow: 0 6px 20px rgba(0,0,0,.08); padding: 1rem; }
    .row { display:flex; gap:.75rem; align-items:center; flex-wrap: wrap; }
    .muted { color:#777; }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding:.5rem .6rem; border-bottom:1px solid #eee; }
    .small { font-size:.9rem; }
    .right { text-align:right; }
    .pill { padding:.2rem .5rem; border-radius:999px; background:#f3f4f6; }
    input[type="number"] { width: 120px; padding:.4rem .5rem; border:1px solid #e5e7eb; border-radius:8px; }
    input.inline { width: 100px; }
    canvas { max-height: 360px; }
  </style> -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  </head>
  <body>
    <header class="header collapsedx" id="nav-Bar">
      <nav class="navbar">
        <div class="close-nav">
          <button class="close-nav-button" id="close-nav">X</button>
        </div>
        <div class="Title_logo">
          <img src="/images/default-avatar.png" alt="Logo" class="logo" />
          <h2><%= t('title') %></h2>
        </div>
        <div class="main-nav">
          <ul class="nav-links">
              <li><a href="/dashboard"><%= t('nav.home') %></a></li>
              <li><a href="/earnings"><%= t('nav.earnings') %></a></li>
              <li><a href="/expenses"><%= t('nav.expenses') %></a></li>
              <li><a href="/results"><%= t('nav.results') %></a></li>
              <li><a href="/auth/logout"><%= t('nav.logout') %></a></li>
            </ul>
          </div>
        </nav>
      </header>
      <button class="open-nav" id="open-nav"><i class="fas fa-bars"></i></button>
    <div class="profile-dark-bar" id="darkModebar">
      <div class="lang">
        <select id="language-select">
          <option value="en" <%= lang === 'en' ? 'selected' : '' %>>English</option>
          <option value="es" <%= lang === 'es' ? 'selected' : '' %>>Español</option>
        </select>
      </div>
      <div class="theme-switch">
        <i class="fas fa-sun"></i> 
        <input type="checkbox" id="theme-toggle"/> <!-- Light mode icon -->
        <label for="theme-toggle" class="theme-toggle-label"></label>
        <i class="fas fa-moon"></i>
      </div>
      <div class="profilePic">
        <a href="/profile">
        <img id="siteProfile"
          src="<%= (user && user.profilePic) ? user.profilePic : '/images/logo.png' %>"
          alt="Profile Picture" width="150" 
        />
      </a>
      </div>
      <script>
        document.getElementById('language-select').addEventListener('change', function () {
          const params = new URLSearchParams(window.location.search);
          params.set('lang', this.value);
          window.location.search = params.toString();
        });
      </script>
    </div>

<h1 id="titleh1">Cooked Borys</h1>
  <main class="grid grid-2" style="padding:1rem;">
    <!-- Controls -->
    <section class="card" style="grid-column: 1 / -1;">
      <div class="row1">
        <div class="row1">
          <label class="pill">Basis month</label>
          <input id="basis" type="month" />
        </div>
        <div class="row1">
          <label class="pill">Horizon (years)</label>
          <input id="years" type="number" min="1" step="1" value="1" />
        </div>
        <button id="reload" class="pill" style="cursor:pointer;border:none;">Reload data</button>
        <span class="muted small">One-time items count in the chosen basis month.</span>
      </div>
    </section>

    <!-- Actuals -->
    <section class="card">
      <h2>Actuals (Monthly)</h2>
      <div class="row1 muted small">
        <span id="actuals-monthly-summary"></span>
      </div>
      <canvas id="actualsChart"></canvas>
      <hr/>
      <h3 class="small">Breakdown</h3>
      <table class="table small" id="actualsTable">
        <thead><tr><th>Income</th><th class="right">Monthly</th></tr></thead>
        <tbody id="incomeBody"></tbody>
      </table>
      <table class="table small" id="actualsExpenseTable" style="margin-top:.75rem;">
        <thead><tr><th>Expense</th><th class="right">Monthly</th></tr></thead>
        <tbody id="expenseBody"></tbody>
      </table>
    </section>

    <!-- What-If (editable) -->
    <section class="card">
      <h2>What-If </h2>
      <div class="row1 muted small">
        <span id="whatif-monthly-summary"></span>
      </div>
      <canvas id="whatIfChart"></canvas>
      <hr/>
      <div class="small muted">Edit the numbers below to simulate changes. Chart updates live.</div>
      <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div>
          <h3 class="small">Income (Monthly)</h3>
          <table class="table small" id="editIncomeTable">
            <thead><tr><th>Source</th><th class="right">Amount</th></tr></thead>
            <tbody id="editIncomeBody"></tbody>
          </table>
        </div>
        <div>
          <h3 class="small">Expenses (Monthly)</h3>
          <table class="table small" id="editExpenseTable">
            <thead><tr><th>Category</th><th class="right">Amount</th></tr></thead>
            <tbody id="editExpenseBody"></tbody>
          </table>
        </div>
      </div>
      <div class="row1 muted small" style="margin-top:.5rem;">
        <span id="horizon-summary"></span>
      </div>
    </section>
  </main>
<div class="circle-container" id="open-chat-container">
    <button class="rotate-up" id="open-chat">&gt;</button>  
  </div>
  <div class="aiSection collapsed" id="ai-section">
      <div class="chat-bar">
        <button class="close-chat" id="close-chat">×</button>
      </div>
      <div id="chat-box">
      </div>
      <form id="chat-form">
        <input type="text" id="user-input" placeholder="Ask a finance question..." autocomplete="off" required />
        <button class="submit-prompt" type="submit">Send</button>
      </form>
  </div>
</main>
<footer>
	<div class="footer-content">
		<% const Today = new Date() %>
		<% const year = Today.getFullYear()  %>
		<p>&copy; <%= year %> Debt Tracers. All rights reserved.</p>
		<ul class="social-links">
			<!-- we could create a fake page for them or just make the button functional to an empty page or sign up page-->
		<li><a href="https://www.facebook.com" target="_blank">Facebook</a></li>
		<li><a href="https://www.twitter.com" target="_blank">Twitter</a></li>
		<li><a href="https://www.instagram.com" target="_blank">Instagram</a></li>
		<li><a href="https://www.linkedin.com" target="_blank">LinkedIn</a></li>
		</ul>
  </div>
</footer>
<script src="/index.js"></script>
<script src="/js/analytics.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/your-code.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>


